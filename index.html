<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Load GeoJSON from Wikipedia dynamically</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    #map {
      width: 500px;
      height: 500px;
    }

  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
  integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
  crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
  integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
  crossorigin=""></script>
  <script src='osmtogeojson.js'></script>
</head>
<body>
<div id="map"></div>
<input type="button" value="Load 1st GeoJSON" onclick="showGeoJson(firstGeoJson)">
<input type="button" value="Load Baden GeoJSON" onclick="showGeoJson(BadenGeoJson)">
<input type="button" value="Get bbox coordinates" onclick="getBboxCoordinates()">
<input type="button" value="Load GeoJSON from Overpass" onclick="fetchExternalGeojson()">

<input type="button" value="Hide polygons" onclick="hidePolygons()">

<br>

<input type="checkbox" name="all-sel" id = "all-sel" value="0" checked onclick="selectAll()"> Select/Deselect all<br>
<input type="checkbox" name="admin-levels" value="1" checked> 1<br>
<input type="checkbox" name="admin-levels" value="2" checked> 2<br>
<input type="checkbox" name="admin-levels" value="3" checked> 3<br>
<input type="checkbox" name="admin-levels" value="4" checked> 4<br>
<input type="checkbox" name="admin-levels" value="5" checked> 5<br>
<input type="checkbox" name="admin-levels" value="6" checked> 6<br>
<input type="checkbox" name="admin-levels" value="7" checked> 7<br>
<input type="checkbox" name="admin-levels" value="8" checked> 8<br>
<input type="checkbox" name="admin-levels" value="9" checked> 9<br>
<input type="checkbox" name="admin-levels" value="10" checked> 10<br>

<script>
  var firstGeoJson={
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "admin_level": 1
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              8.305878639221191,
              47.48033499841769
            ],
            [
              8.30742359161377,
              47.478710746833485
            ],
            [
              8.311071395874023,
              47.47995794448956
            ],
            [
              8.310105800628662,
              47.482220227468304
            ],
            [
              8.308131694793701,
              47.48220572596455
            ],
            [
              8.305878639221191,
              47.48033499841769
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "admin_level": 2
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              8.30765962600708,
              47.48079906107601
            ],
            [
              8.305299282073975,
              47.47791310490395
            ],
            [
              8.308753967285156,
              47.47485294807404
            ],
            [
              8.312294483184814,
              47.47705743919014
            ],
            [
              8.312294483184814,
              47.482147719909584
            ],
            [
              8.30765962600708,
              47.48079906107601
            ]
          ]
        ]
      }
    }
  ]
};
  var BadenGeoJson={
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "@id": "relation/1684261",
        "admin_level": "8",
        "boundary": "administrative",
        "name": "Baden",
        "source": "swissBOUNDARIES3D swisstopo 2011",
        "swisstopo:BEZIRKSNUM": "1902",
        "swisstopo:BFS_NUMMER": "4021",
        "swisstopo:KANTONSNUM": "19",
        "swisstopo:OBJEKTART": "Gemeindegebiet",
        "swisstopo:SHN": "CH19024021",
        "type": "boundary",
        "wikidata": "Q63939",
        "wikipedia": "de:Baden AG"
      },
      "geometry": {
        "type": "MultiPolygon",
        "coordinates": [
          [
            [
              [
                8.2688711,
                47.4336396
              ],
              [
                8.2686997,
                47.434668
              ],
              [
                8.2720627,
                47.4348176
              ],
              [
                8.2719636,
                47.435892
              ],
              [
                8.2718921,
                47.4360893
              ],
              [
                8.2752,
                47.4373199
              ],
              [
                8.2755702,
                47.4381653
              ],
              [
                8.2756936,
                47.4389137
              ],
              [
                8.2757199,
                47.4397888
              ],
              [
                8.2755007,
                47.4400715
              ],
              [
                8.2759878,
                47.4404896
              ],
              [
                8.2743034,
                47.4414012
              ],
              [
                8.2740777,
                47.4412679
              ],
              [
                8.2728428,
                47.4423168
              ],
              [
                8.2733397,
                47.4425869
              ],
              [
                8.2732625,
                47.4426567
              ],
              [
                8.27242,
                47.4434108
              ],
              [
                8.2724281,
                47.4434552
              ],
              [
                8.2718243,
                47.4439488
              ],
              [
                8.2698793,
                47.4430295
              ],
              [
                8.2689685,
                47.4425469
              ],
              [
                8.2688796,
                47.4426825
              ],
              [
                8.2674886,
                47.4422871
              ],
              [
                8.2658898,
                47.4416704
              ],
              [
                8.2647398,
                47.441025
              ],
              [
                8.2647464,
                47.4409977
              ],
              [
                8.2652422,
                47.4410399
              ],
              [
                8.2658412,
                47.4410041
              ],
              [
                8.2657673,
                47.4405219
              ],
              [
                8.2651843,
                47.4394961
              ],
              [
                8.2640042,
                47.4382032
              ],
              [
                8.2639026,
                47.4382364
              ],
              [
                8.2638038,
                47.4381035
              ],
              [
                8.2637428,
                47.4379128
              ],
              [
                8.2637441,
                47.437463
              ],
              [
                8.2631544,
                47.4373716
              ],
              [
                8.2611598,
                47.4364358
              ],
              [
                8.2616246,
                47.4359546
              ],
              [
                8.2620595,
                47.4356817
              ],
              [
                8.2632123,
                47.4352182
              ],
              [
                8.263911,
                47.4348647
              ],
              [
                8.2646913,
                47.4342182
              ],
              [
                8.2652687,
                47.4338453
              ],
              [
                8.2662229,
                47.433291
              ],
              [
                8.2666433,
                47.4331475
              ],
              [
                8.2686068,
                47.4329156
              ],
              [
                8.2687282,
                47.4329639
              ],
              [
                8.2688658,
                47.433289
              ],
              [
                8.2688711,
                47.4336396
              ]
            ]
          ],
          [
            [
              [
                8.3139818,
                47.4740167
              ],
              [
                8.3138237,
                47.4740902
              ],
              [
                8.3128472,
                47.4737991
              ],
              [
                8.3112749,
                47.473153
              ],
              [
                8.3104765,
                47.473084
              ],
              [
                8.3101021,
                47.4739554
              ],
              [
                8.3098735,
                47.4747185
              ],
              [
                8.3097799,
                47.4752892
              ],
              [
                8.3100243,
                47.4760765
              ],
              [
                8.3104742,
                47.4766454
              ],
              [
                8.3117243,
                47.4776036
              ],
              [
                8.3127313,
                47.4784552
              ],
              [
                8.3135508,
                47.4794102
              ],
              [
                8.3143328,
                47.4801406
              ],
              [
                8.3147124,
                47.4806121
              ],
              [
                8.3147201,
                47.4809924
              ],
              [
                8.3145073,
                47.4813895
              ],
              [
                8.3137345,
                47.4818234
              ],
              [
                8.3130719,
                47.4819532
              ],
              [
                8.3117793,
                47.4820072
              ],
              [
                8.3106489,
                47.481921
              ],
              [
                8.3099158,
                47.4818547
              ],
              [
                8.3090221,
                47.4820914
              ],
              [
                8.3073053,
                47.4822852
              ],
              [
                8.3063425,
                47.4822772
              ],
              [
                8.3055839,
                47.4822125
              ],
              [
                8.3018153,
                47.4822149
              ],
              [
                8.3011414,
                47.4823492
              ],
              [
                8.3007458,
                47.4825908
              ],
              [
                8.3002609,
                47.4830474
              ],
              [
                8.2998774,
                47.4835849
              ],
              [
                8.2991231,
                47.4841023
              ],
              [
                8.298546,
                47.4843645
              ],
              [
                8.2975676,
                47.4845869
              ],
              [
                8.2962239,
                47.484738
              ],
              [
                8.2954384,
                47.4848697
              ],
              [
                8.2948252,
                47.4850316
              ],
              [
                8.2944673,
                47.4850511
              ],
              [
                8.2937715,
                47.4850127
              ],
              [
                8.2908381,
                47.4845021
              ],
              [
                8.2905318,
                47.4844075
              ],
              [
                8.289508,
                47.4843392
              ],
              [
                8.2888798,
                47.4843749
              ],
              [
                8.2876554,
                47.4845945
              ],
              [
                8.2847675,
                47.4854229
              ],
              [
                8.2823219,
                47.4854715
              ],
              [
                8.2814257,
                47.4853505
              ],
              [
                8.2810272,
                47.4852075
              ],
              [
                8.2804275,
                47.4848538
              ],
              [
                8.2794509,
                47.4840808
              ],
              [
                8.2788612,
                47.4837336
              ],
              [
                8.2782742,
                47.4834792
              ],
              [
                8.2778277,
                47.4833106
              ],
              [
                8.2771954,
                47.4831565
              ],
              [
                8.2765995,
                47.4830412
              ],
              [
                8.2758312,
                47.4829936
              ],
              [
                8.2750448,
                47.4831796
              ],
              [
                8.2738151,
                47.483196
              ],
              [
                8.2722291,
                47.4833815
              ],
              [
                8.2712143,
                47.4837161
              ],
              [
                8.2709334,
                47.4839744
              ],
              [
                8.2706049,
                47.4845875
              ],
              [
                8.2693041,
                47.4840248
              ],
              [
                8.2689824,
                47.4843376
              ],
              [
                8.2686831,
                47.4840785
              ],
              [
                8.2680378,
                47.4838108
              ],
              [
                8.2672885,
                47.4821027
              ],
              [
                8.2671488,
                47.4811475
              ],
              [
                8.2671706,
                47.4802595
              ],
              [
                8.2671377,
                47.4798478
              ],
              [
                8.2672368,
                47.4784109
              ],
              [
                8.2668351,
                47.4779948
              ],
              [
                8.2666987,
                47.477754
              ],
              [
                8.2661311,
                47.4770912
              ],
              [
                8.2657079,
                47.4764232
              ],
              [
                8.2659117,
                47.4752454
              ],
              [
                8.2660274,
                47.4745771
              ],
              [
                8.2662228,
                47.474122
              ],
              [
                8.2664994,
                47.4734776
              ],
              [
                8.2666254,
                47.4730494
              ],
              [
                8.2668684,
                47.4726822
              ],
              [
                8.2670872,
                47.4720685
              ],
              [
                8.2677187,
                47.4713776
              ],
              [
                8.2685398,
                47.4703374
              ],
              [
                8.2699827,
                47.4682359
              ],
              [
                8.2699717,
                47.4680616
              ],
              [
                8.2701696,
                47.4667009
              ],
              [
                8.2702,
                47.4656805
              ],
              [
                8.2699433,
                47.4641233
              ],
              [
                8.2698586,
                47.4627797
              ],
              [
                8.2699485,
                47.4620221
              ],
              [
                8.2707317,
                47.4605789
              ],
              [
                8.271382,
                47.459808
              ],
              [
                8.2712414,
                47.459424
              ],
              [
                8.2712472,
                47.4591243
              ],
              [
                8.2712577,
                47.4585857
              ],
              [
                8.271655,
                47.4585491
              ],
              [
                8.2720432,
                47.4584564
              ],
              [
                8.2736048,
                47.4576131
              ],
              [
                8.2737043,
                47.4576124
              ],
              [
                8.2737359,
                47.4575167
              ],
              [
                8.274574,
                47.4575837
              ],
              [
                8.2751137,
                47.4564548
              ],
              [
                8.2743053,
                47.4562218
              ],
              [
                8.2736489,
                47.4559747
              ],
              [
                8.2748395,
                47.4549565
              ],
              [
                8.2750344,
                47.4547021
              ],
              [
                8.2763707,
                47.4537762
              ],
              [
                8.2768915,
                47.4531653
              ],
              [
                8.2774172,
                47.4523295
              ],
              [
                8.2775972,
                47.4521953
              ],
              [
                8.2784278,
                47.4512485
              ],
              [
                8.2789286,
                47.4504241
              ],
              [
                8.2796246,
                47.4489791
              ],
              [
                8.2802977,
                47.4477711
              ],
              [
                8.2806625,
                47.4473774
              ],
              [
                8.282365,
                47.4471865
              ],
              [
                8.2836149,
                47.4469849
              ],
              [
                8.2854986,
                47.4465639
              ],
              [
                8.2886889,
                47.4462942
              ],
              [
                8.2907939,
                47.445139
              ],
              [
                8.2908254,
                47.4451678
              ],
              [
                8.2916987,
                47.4447613
              ],
              [
                8.2914669,
                47.4443251
              ],
              [
                8.2914918,
                47.4442405
              ],
              [
                8.2921931,
                47.4435774
              ],
              [
                8.2927992,
                47.4435612
              ],
              [
                8.2927896,
                47.4434769
              ],
              [
                8.29298,
                47.44347
              ],
              [
                8.2930518,
                47.4438123
              ],
              [
                8.2944764,
                47.4439756
              ],
              [
                8.2935435,
                47.4455345
              ],
              [
                8.2946101,
                47.4459033
              ],
              [
                8.2967123,
                47.4467646
              ],
              [
                8.2966264,
                47.4469335
              ],
              [
                8.29763,
                47.4473134
              ],
              [
                8.2987005,
                47.4478256
              ],
              [
                8.3004168,
                47.4472825
              ],
              [
                8.3008054,
                47.4472234
              ],
              [
                8.302213,
                47.4471722
              ],
              [
                8.3031624,
                47.4470319
              ],
              [
                8.3070546,
                47.446755
              ],
              [
                8.3076738,
                47.4455867
              ],
              [
                8.3079003,
                47.4452442
              ],
              [
                8.3102869,
                47.4462566
              ],
              [
                8.3114508,
                47.447423
              ],
              [
                8.3119996,
                47.4495383
              ],
              [
                8.3108543,
                47.4499146
              ],
              [
                8.3100445,
                47.4502665
              ],
              [
                8.3080744,
                47.4506971
              ],
              [
                8.3074593,
                47.4516157
              ],
              [
                8.3070535,
                47.4528358
              ],
              [
                8.3062382,
                47.4531381
              ],
              [
                8.3048222,
                47.4535457
              ],
              [
                8.304603,
                47.4537798
              ],
              [
                8.3044012,
                47.4542623
              ],
              [
                8.3075889,
                47.4556274
              ],
              [
                8.3070635,
                47.4564464
              ],
              [
                8.306502,
                47.4570802
              ],
              [
                8.3072755,
                47.4577804
              ],
              [
                8.3079245,
                47.458147
              ],
              [
                8.3092441,
                47.4576914
              ],
              [
                8.3097905,
                47.4574428
              ],
              [
                8.3099702,
                47.457488
              ],
              [
                8.3101129,
                47.4574666
              ],
              [
                8.3100327,
                47.4579525
              ],
              [
                8.3099209,
                47.458173
              ],
              [
                8.3096503,
                47.4584496
              ],
              [
                8.3094696,
                47.4589037
              ],
              [
                8.3098707,
                47.4592976
              ],
              [
                8.3108077,
                47.4600361
              ],
              [
                8.3097009,
                47.4604407
              ],
              [
                8.3087073,
                47.4623598
              ],
              [
                8.3089251,
                47.4640967
              ],
              [
                8.3085102,
                47.4656053
              ],
              [
                8.3111724,
                47.4648985
              ],
              [
                8.3121235,
                47.4662798
              ],
              [
                8.3120469,
                47.4686864
              ],
              [
                8.312258,
                47.468415
              ],
              [
                8.3125963,
                47.4685611
              ],
              [
                8.3128612,
                47.4687904
              ],
              [
                8.3128215,
                47.468812
              ],
              [
                8.3130706,
                47.4690108
              ],
              [
                8.313171,
                47.4689594
              ],
              [
                8.3137862,
                47.4695251
              ],
              [
                8.3148674,
                47.4689568
              ],
              [
                8.3159243,
                47.4700457
              ],
              [
                8.3163059,
                47.4698989
              ],
              [
                8.3165897,
                47.4701755
              ],
              [
                8.3168272,
                47.4701054
              ],
              [
                8.3182091,
                47.4717897
              ],
              [
                8.3193871,
                47.4732255
              ],
              [
                8.3191291,
                47.4733324
              ],
              [
                8.3173234,
                47.4737734
              ],
              [
                8.3157657,
                47.4738376
              ],
              [
                8.3146539,
                47.4741197
              ],
              [
                8.3144904,
                47.4738657
              ],
              [
                8.3139818,
                47.4740167
              ]
            ],
            [
              [
                8.2765106,
                47.4812717
              ],
              [
                8.2764005,
                47.4810315
              ],
              [
                8.2759368,
                47.4809711
              ],
              [
                8.2754972,
                47.4809746
              ],
              [
                8.2754662,
                47.4812147
              ],
              [
                8.2753627,
                47.481664
              ],
              [
                8.2753319,
                47.4819895
              ],
              [
                8.2754793,
                47.4820594
              ],
              [
                8.2758933,
                47.4820673
              ],
              [
                8.2762459,
                47.4820732
              ],
              [
                8.2765848,
                47.4820977
              ],
              [
                8.276923,
                47.482119
              ],
              [
                8.2771925,
                47.482092
              ],
              [
                8.2778065,
                47.482211
              ],
              [
                8.2780574,
                47.4822278
              ],
              [
                8.2782563,
                47.4822151
              ],
              [
                8.2786495,
                47.4820374
              ],
              [
                8.2786933,
                47.4818897
              ],
              [
                8.2786201,
                47.4814555
              ],
              [
                8.2784282,
                47.4813886
              ],
              [
                8.2782665,
                47.4813485
              ],
              [
                8.2781264,
                47.4813349
              ],
              [
                8.2778434,
                47.481361
              ],
              [
                8.277497,
                47.4814039
              ],
              [
                8.2771794,
                47.4814235
              ],
              [
                8.2768354,
                47.4814422
              ],
              [
                8.2765652,
                47.4813957
              ],
              [
                8.2765106,
                47.4812717
              ]
            ]
          ]
        ]
      },
      "id": "relation/1684261"
    },
    {
      "type": "Feature",
      "properties": {
        "@id": "node/61158271",
        "@relations": [
          {
            "role": "admin_centre",
            "rel": 1684261,
            "reltags": {
              "admin_level": "8",
              "boundary": "administrative",
              "name": "Baden",
              "source": "swissBOUNDARIES3D swisstopo 2011",
              "swisstopo:BEZIRKSNUM": "1902",
              "swisstopo:BFS_NUMMER": "4021",
              "swisstopo:KANTONSNUM": "19",
              "swisstopo:OBJEKTART": "Gemeindegebiet",
              "swisstopo:SHN": "CH19024021",
              "type": "boundary",
              "wikidata": "Q63939",
              "wikipedia": "de:Baden AG"
            }
          }
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          8.3086822,
          47.4736827
        ]
      },
      "id": "node/61158271"
    }
  ]
}
  var jsonLayer;
  var osmTiles;
  var mymap;

  //Add the base map without any layers.
  addLeafletMap();

  //Add a Leaflet map to the page
  function addLeafletMap() {
    mymap = L.map('map').setView([0, 0], 1);

    osmTiles = L.tileLayer('https://a.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
    maxZoom: 18
    }).addTo(mymap);
  }

  //Show GeoJSON polygons on the Leaflet map
  function showGeoJson(inputGeoJson) {
    jsonLayer = L.geoJSON(inputGeoJson, {
      onEachFeature: onEachFeature,
      style: style
    })

    jsonLayer.addTo(mymap);

    //Center and zoom the map on the provided GeoJSON
    mymap.fitBounds(jsonLayer.getBounds());
  }

  //Apply standard colors to the polygons (all objects or "features" are forwarded to this function)
  function style() {
    //color = feature.properties.fill; 
    //console.log(color);
    return {"fillColor": undefined, "opacity": 1, "fillOpacity": 0.7, "color": "#555555", "weight": 2};
  }

  //Color polygon red
  function onEachFeature(feature, layer) {
    //bind click
    layer.on('click', function (e) {
      //e=event
      //console.log(e);
      //console.log(feature.properties);
      //console.log("Anzahl der Koordinaten: " +feature.geometry.coordinates[0].length);
      //console.log("Hier sind die Koordinaten gespeichert: " +feature.geometry.coordinates[0][0][0]);
      //createMapmask(feature);
      //console.log(layer);
      //console.log(layer.options.fillColor);
      //var check=layer.options.fillColor === definePolygonColor(feature);
      //console.log(check);

      /*Check, if the polygon already has a color defined.
      If no OR
      If current color is a different one than the one, which is supposed to be applied:
      --> Color the polygon according to the selected district.
      Else if (i.e. color already defined): Remove the color again. Behaves like on/off toggle
      */

      layer.setStyle({fillColor: "red"});

      //console.log("Wikidata ID: " +feature.properties.wikidata);
    });
  }

  function getBboxCoordinates() {
  console.log("Current zoom level: " +mymap.getZoom());
  var bounds = mymap.getBounds();
  var bbox = bounds.getSouthWest().lat + ',' +
             bounds.getSouthWest().lng + ',' +
             bounds.getNorthEast().lat + ',' +
             bounds.getNorthEast().lng;
  return bbox;
  console.log("bbox: " +bbox);
}

  function fetchExternalGeojson() {
    //var bbox = getBboxCoordinates(); //get bounding box from current map view
    var bbox = "47.449,8.287,47.490,8.355"; //Some hardcoded values for bounding box for testing
    //Overpass search query (first with hardcoded bounding box values)
    var searchQuery = '[out:json][timeout:25];(relation["admin_level"~""][wikidata~""]('+bbox+'););out body;>;out skel qt;'
    var searchQueryEnc = encodeURIComponent(searchQuery);
    var apiUrl = "http://overpass-api.de/api/interpreter?data=" + searchQueryEnc;
    console.log(apiUrl);

    fetch(apiUrl)
    .then(handleErrors)
    .then(function(response) {
      return response.json();
    })
    .then(function (overpassJson) {
      //console.log(overpassJson);
      //Convert JSON from overpass turbo into a proper GeoJSON
      var convGeoJson = osmtogeojson(overpassJson);
      console.log(convGeoJson);
      showGeoJson(convGeoJson);
    }).catch(function(error) {
      console.log("Da isch äbbes schief gange! Fehlermeldung: " +error);
    });
  }

  //Check response from API. If error throw it to catch
  function handleErrors(response) {
    if (!response.ok) {
      throw Error(response.statusText);
    }
    return response;
  }

  //Select/deselect all
  function selectAll() {
    var allcheckboxes = document.getElementsByName("admin-levels");
    var allseldesel = document.getElementById("all-sel");

    for (i=0; i<allcheckboxes.length; i++) {
      allcheckboxes[i].checked = allseldesel.checked;
    }
  }

  //Hide all polygons (Make transparent is not the right way because the polygon is still clickable)
  function hidePolygons() {
    jsonLayer.eachLayer(function (layer) {
    //console.log(layer.feature.properties.wikidata);
    layer.setStyle({color: 'rgba(0,0,0,0)'})
    });
  }
</script>

</body>
</html>